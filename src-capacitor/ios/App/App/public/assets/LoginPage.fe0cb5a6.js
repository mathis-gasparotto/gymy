import{f as g,d as Y,z as f,H as k,A as Z,n as $,h as d,T as ee,g as te,Q as se,m as ae,I as C,j as ie,a as oe,J as re,r as le,o as L,K as R,b as o,w as r,L as T,M as I,N as ne,O as q,R as ue,S as F,U as Q,V as h,X as de,Y as p,Z as A,$ as me,a0 as ce,a1 as ge,a2 as fe,a3 as ve}from"./index.1d7fae07.js";import{Q as B}from"./QForm.aefa9904.js";import{C as he}from"./ClosePopup.e58e1c04.js";import{s as pe,l as we,a as ye}from"./authService.4b131235.js";import{t as M}from"./translatting.6793a7ea.js";import{s as Se,e as be}from"./notifyHelper.ce085942.js";import{_ as _e}from"./icon.4862f350.js";const Pe={ratio:[String,Number]};function xe(e,s){return g(()=>{const m=Number(e.ratio||(s!==void 0?s.value:void 0));return isNaN(m)!==!0&&m>0?{paddingBottom:`${100/m}%`}:null})}const Ce=1.7778;var qe=Y({name:"QImg",props:{...Pe,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:Ce},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:s,emit:m}){const b=f(e.initialRatio),i=xe(e,b),l=ie(),{registerTimeout:_,removeTimeout:a}=k(),{registerTimeout:v,removeTimeout:N}=k(),P=g(()=>e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null),U=g(()=>e.errorSrc!==void 0?{src:e.errorSrc,__qerror:!0}:null),n=[f(null),f(P.value)],u=f(0),w=f(!1),y=f(!1),E=g(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),H=g(()=>({width:e.width,height:e.height})),j=g(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition q-img__image--`),G=g(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));function O(){if(N(),e.loadingShowDelay===0){w.value=!0;return}v(()=>{w.value=!0},e.loadingShowDelay)}function x(){N(),w.value=!1}function J({target:t}){C(l)===!1&&(a(),b.value=t.naturalHeight===0?.5:t.naturalWidth/t.naturalHeight,V(t,1))}function V(t,c){c===1e3||C(l)===!0||(t.complete===!0?K(t):_(()=>{V(t,c+1)},50))}function K(t){C(l)!==!0&&(u.value=u.value^1,n[u.value].value=null,x(),t.getAttribute("__qerror")!=="true"&&(y.value=!1),m("load",t.currentSrc||t.src))}function W(t){a(),x(),y.value=!0,n[u.value].value=U.value,n[u.value^1].value=P.value,m("error",t)}function z(t){const c=n[t].value,S={key:"img_"+t,class:j.value,style:G.value,alt:e.alt,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...c};return u.value===t?Object.assign(S,{class:S.class+"current",onLoad:J,onError:W}):S.class+="loaded",d("div",{class:"q-img__container absolute-full",key:"img"+t},d("img",S))}function X(){return w.value===!1?d("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},te(s[y.value===!0?"error":"default"])):d("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},s.loading!==void 0?s.loading():e.noSpinner===!0?void 0:[d(se,{color:e.spinnerColor,size:e.spinnerSize})])}{let t=function(){ae(()=>e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null,c=>{a(),y.value=!1,c===null?(x(),n[u.value^1].value=P.value):O(),n[u.value].value=c},{immediate:!0})};Z.value===!0?$(t):t()}return()=>{const t=[];return i.value!==null&&t.push(d("div",{key:"filler",style:i.value})),n[0].value!==null&&t.push(z(0)),n[1].value!==null&&t.push(z(1)),t.push(d(ee,{name:"q-transition--fade"},X)),d("div",{key:"main",class:E.value,style:H.value,role:"img","aria-label":e.alt},t)}}});const Fe={name:"LoginPage",data(){return{form:{email:"",password:""},showPassword:!1,forgotPassword:!1,sendResetPasswordLoading:!1,emailForForgotPassword:"",resetPasswordNotif:null,loading:!1,validate:!1}},watch:{form:{handler(){this.form.email&&this.form.password?(this.$refs.loginForm.validate().then(e=>{e?this.validate=!0:this.validate=!1}),this.validate=!0):this.validate=!1},deep:!0}},methods:{showForgotPassword(){this.forgotPassword=!0,this.emailForForgotPassword=this.form.email},sendResetPassword(){this.sendResetPasswordLoading=!0,pe(this.emailForForgotPassword).then(()=>{this.resetPasswordNotif={variant:"positive",message:"Un email de r\xE9initialisation de mot de passe vous a \xE9t\xE9 envoy\xE9.<br/>Pensez \xE0 v\xE9rifier vos spams !"},this.sendResetPasswordLoading=!1}).catch(e=>{this.resetPasswordNotif={variant:"negative",message:M().translateResetPasswordError(e,"Une erreur est survenue lors de l'envoi de l'email de r\xE9initialisation de mot de passe")},this.sendResetPasswordLoading=!1})},onsubmit(){this.loading=!0,this.$refs.loginForm.validate().then(e=>{e?we(this.form.email,this.form.password).then(()=>{this.$router.push({name:"index"}),Se("Vous \xEAtes d\xE9sormais connect\xE9")}).catch(s=>{this.loading=!1,be(M().translateSigninError(s))}):this.loading=!1})},continueAsGuest(){re.create({title:"Continuer en tant qu'invit\xE9",message:"Tu ne pourra pas retouver tes donn\xE9es depuis un autre appareil, et si tu d\xE9sinstalles l'application, tu perdras toutes tes donn\xE9es.<br/><b>Tu pourra te connecter plus tard pour sauvegarder tes donn\xE9es en ligne et y acc\xE9der depuis un autre appareil \u{1F609}</b>",html:!0,ok:{label:"Continuer",color:"primary"},cancel:{label:"Annuler",color:"negative"}}).onOk(()=>{ye(),this.$router.push({name:"index"})})}}},D=e=>(fe("data-v-3c632cfa"),e=e(),ve(),e),Ne={class:"login-page page"},Ve=D(()=>p("p",{class:"q-my-xs text-center"},null,-1)),ze={class:"q-my-xs text-center"},ke=D(()=>p("div",{class:"text-h6 text-center"},"R\xE9initialisez votre mot de passe",-1)),Le=["innerHTML"];function Re(e,s,m,b,i,l){const _=le("router-link");return L(),R("div",Ne,[o(qe,{src:_e,style:{width:"200px"},class:"q-mb-xl"}),o(B,{class:"flex flex-center column form login-form",ref:"loginForm",onSubmit:s[3]||(s[3]=T(a=>l.onsubmit(),["prevent"]))},{default:r(()=>[o(q,{name:"email",rounded:"",outlined:"",label:"Adresse mail",class:"q-mb-md login-input",type:"email",inputmode:"email",modelValue:i.form.email,"onUpdate:modelValue":s[0]||(s[0]=a=>i.form.email=a),rules:[(a,v)=>v.email(a)||"Veuillez renseigner une adresse email valide"],"lazy-rules":"","hide-bottom-space":""},null,8,["modelValue","rules"]),o(q,{name:"password",rounded:"",outlined:"",label:"Mot de passe",class:"q-mb-md login-input",type:i.showPassword?"text":"password",modelValue:i.form.password,"onUpdate:modelValue":s[2]||(s[2]=a=>i.form.password=a),rules:[a=>a.trim().length>0||"Veuillez remplir ce champ"],"lazy-rules":"","hide-bottom-space":""},{append:r(()=>[o(ue,{name:i.showPassword?"visibility":"visibility_off",class:"cursor-pointer",color:"primary",onClick:s[1]||(s[1]=a=>i.showPassword=!i.showPassword)},null,8,["name"])]),_:1},8,["type","modelValue","rules"]),o(F,{label:"Se connecter",type:"submit",rounded:"",loading:i.loading,padding:"sm 50px",size:"18px",disable:!i.validate,class:Q(`form-btn btn btn-${i.validate?"primary":"disabled"}`)},null,8,["loading","disable","class"])]),_:1},512),o(I,{flat:""},{default:r(()=>[o(h,null,{default:r(()=>[Ve]),_:1}),o(de,{spaced:"",size:"2px",color:"white",rounded:""}),o(h,{class:"text-center text-bold link"},{default:r(()=>[p("span",{onClick:s[4]||(s[4]=(...a)=>l.showForgotPassword&&l.showForgotPassword(...a))}," Mot de passe oubli\xE9 ? ")]),_:1}),o(h,null,{default:r(()=>[p("p",ze,[A(" Tu n'as pas de compte ? "),o(_,{to:{name:"signup"},class:"text-bold"},{default:r(()=>[A("Inscris toi")]),_:1})]),p("p",{class:"q-my-lg text-center text-bold link",onClick:s[5]||(s[5]=(...a)=>l.continueAsGuest&&l.continueAsGuest(...a))}," Continuer en tant qu'invit\xE9 ")]),_:1})]),_:1}),o(ne,{modelValue:i.forgotPassword,"onUpdate:modelValue":s[7]||(s[7]=a=>i.forgotPassword=a)},{default:r(()=>[o(I,{class:"q-px-xs q-py-xs"},{default:r(()=>[o(h,{align:"center"},{default:r(()=>[ke]),_:1}),o(h,{align:"center",class:"column"},{default:r(()=>[o(B,{ref:"sendResetPasswordForm",onSubmit:T(l.sendResetPassword,["prevent"])},{default:r(()=>[o(q,{name:"email",outlined:"",class:"q-mb-md",type:"email",inputmode:"email",modelValue:i.emailForForgotPassword,"onUpdate:modelValue":s[6]||(s[6]=a=>i.emailForForgotPassword=a),min:"1",rules:[(a,v)=>v.email(a)||"Veuillez renseigner une adresse email valide"],label:"Adresse mail","lazy-rules":"","hide-bottom-space":""},null,8,["modelValue","rules"]),i.resetPasswordNotif?(L(),R("p",{key:0,class:Q("text-"+i.resetPasswordNotif.variant),innerHTML:i.resetPasswordNotif.message},null,10,Le)):me("",!0),o(F,{label:"Envoyer",icon:"send",type:"submit",loading:i.sendResetPasswordLoading,color:"primary"},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1}),o(ce,{align:"center"},{default:r(()=>[ge(o(F,{label:"Fermer",color:"negative"},null,512),[[he]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Ue=oe(Fe,[["render",Re],["__scopeId","data-v-3c632cfa"]]);export{Ue as default};
