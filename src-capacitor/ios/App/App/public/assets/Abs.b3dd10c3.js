import{Q as k}from"./QItemLabel.3064b917.js";import{d as I,aS as N,aT as L,f as C,h as q,g as D,j as w,a as R,aU as V,aV as P,r as S,o as n,c as b,w as c,K as o,aN as a,$ as m,b as u,Y as d,Z as p,aP as F,aQ as Q,O as B,S as x,U as T,V as y,M as W,a2 as U,a3 as z}from"./index.1d7fae07.js";import{Q as G}from"./QPage.783d00bb.js";import{G as H}from"./GymyHeader.dde444e5.js";import{e as E}from"./notifyHelper.ce085942.js";import{f as M}from"./formatting.660d74af.js";import{u as f}from"./index.dcb3acae.js";var j=I({name:"QList",props:{...N,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(e,{slots:i}){const s=w(),h=L(e,s.proxy.$q),t=C(()=>"q-list"+(e.bordered===!0?" q-list--bordered":"")+(e.dense===!0?" q-list--dense":"")+(e.separator===!0?" q-list--separator":"")+(h.value===!0?" q-list--dark":"")+(e.padding===!0?" q-list--padding":""));return()=>q(e.tag,{class:t.value},D(i.default))}}),O="assets/Finish First Mario Kart Wii.48870a2f.mp3",K="assets/mariostart.01b0a888.mp3",Y="assets/ding.1c0ea64c.mp3",Z="assets/timer-in-progress.c695b62b.mp3",J="assets/clock-ticking.b4809428.mp3";const X={name:"Abs",components:{GymyHeader:H},setup(){const{play:e,stop:i}=f(O,{volume:.5,autoplay:!1,interrupt:!0}),{play:s,stop:h}=f(K,{volume:.5,autoplay:!1,interrupt:!0}),{play:t,stop:r}=f(Y,{volume:1,autoplay:!1,interrupt:!0}),{play:v,stop:g}=f(Z,{volume:1,autoplay:!1,interrupt:!0,loop:!0}),{play:l,stop:_}=f(J,{volume:1,autoplay:!1,interrupt:!0,loop:!0});return{formatting:M,playEnd:e,playCountdown:s,playDing:t,playInProgress:v,stopInProgress:g,stopEnd:i,stopCountdown:h,stopDing:r,playLast3Sec:l,stopLast3Sec:_}},data(){return{modal:!1,workouts:[],seriesNb:null,currentSeries:null,started:!1,preWorkoutTimer:null,timer:null,step:null,finished:!1,rest:!1,intervals:[],timeouts:[],totalRemainingTime:null,paused:!1,finishTime:{interval:null,value:null},displayNextExercise:3}},created(){this.reloadData(),this.$router.beforeEach((e,i,s)=>{this.started?s(!1):s()})},beforeMount(){window.addEventListener("beforeunload",this.preventReload)},beforeUnmount(){this.stopAllIntervals(),this.stopAllTimeouts(),this.stopAllSounds(),this.$emit("showNavbar"),window.removeEventListener("beforeunload",this.preventReload)},watch:{seriesNb(e){this.seriesNb=parseInt(e)}},computed:{isValid(){return this.seriesNb>0&&this.workouts.some(e=>e.selected)},selectedWorkout(){const e=this.workouts.find(i=>i.selected);return e?(e.exercises=V(e.id),e):null},totalDuration(){return this.selectedWorkout.durationWithoutFinishers*this.seriesNb+this.selectedWorkout.restTime*(this.seriesNb-1)+(this.selectedWorkout.duration-this.selectedWorkout.durationWithoutFinishers)},nbExercises(){return this.lastSeries?this.selectedWorkout.exercises.length:this.selectedWorkout.exercises.filter(e=>!e.forLastSeries).length},currentExercise(){return this.lastSeries?this.selectedWorkout.exercises[this.step-1]:this.selectedWorkout.exercises.filter(e=>!e.forLastSeries)[this.step-1]},futurExercise(){const e=this.lastSeries?this.selectedWorkout.exercises:this.selectedWorkout.exercises.filter(s=>!s.forLastSeries),i=this.seriesNb===this.currentSeries+1?this.selectedWorkout.exercises:this.selectedWorkout.exercises.filter(s=>!s.forLastSeries);switch(!0){case(this.lastExercise&&this.lastSeries):return null;case(this.lastExercise&&this.rest):return i[0];case this.lastExercise:return{label:"Repos",restAbs:!0};default:return e[this.step]}},lastExercise(){return this.step===this.nbExercises},lastSeries(){return this.currentSeries===this.seriesNb}},methods:{reloadData(){this.seriesNb=null,this.currentSeries=null,this.started=!1,this.preWorkoutTimer=null,this.timer=null,this.step=null,this.finished=!1,this.rest=!1,this.intervals=[],this.timeouts=[],this.totalRemainingTime=null,this.paused=!1,this.finishTime.interval&&clearInterval(this.finishTime.interval),this.finishTime.interval=null,this.finishTime.value=null,this.workouts=P().map(e=>({...e,selected:!1,duration:Object.values(e.exercises).reduce((i,s)=>i+s.duration,0)||0,durationWithoutFinishers:Object.values(e.exercises).reduce((i,s)=>i+(s.forLastSeries?0:s.duration),0)||0}))},onAbsWorkoutSelectectUpdate(){this.isValid&&(this.finishTime.value=this.getEndTime(this.totalDuration+3),this.finishTime.interval=setInterval(()=>{this.finishTime.value=this.getEndTime(this.totalDuration+3),(!this.isValid||this.started||this.preWorkoutTimer!==null)&&clearInterval(this.finishTime.interval)},1e3))},getEndTime(e){const s=new Date().getTime()+e*1e3;return s%6e4>45*1e3?s+6e4-s%6e4:s},preventReload(e){!this.started||(e.preventDefault(),e.returnValue="")},selectWorkout(e){this.workouts.forEach(i=>i.selected=i.id==e.id),this.onAbsWorkoutSelectectUpdate()},playSoundLast3Sec(){this.stopInProgress(),this.playLast3Sec()},pauseAbs(){this.paused=!0,this.stopAllIntervals(),this.stopAllTimeouts(),this.stopAllSounds(),this.finishTime.interval=setInterval(()=>{this.finishTime.value=this.getEndTime(this.totalRemainingTime)},1e3)},resumeAbs(){this.paused=!1,this.startTimer(this.timer),clearInterval(this.finishTime.interval),this.finishTime.interval=null},stopAbs(){this.stopAllIntervals(),this.stopAllTimeouts(),this.stopAllSounds(),this.reloadData(),this.$emit("showNavbar")},stopAllSounds(){this.stopInProgress(),this.stopEnd(),this.stopCountdown(),this.stopDing(),this.stopLast3Sec()},stopAllIntervals(){this.intervals.forEach(e=>clearInterval(e)),this.intervals=[]},stopAllTimeouts(){this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts=[]},start(){if(!this.selectedWorkout){E("Veuillez s\xE9lectionner un exercice");return}if(!this.seriesNb){E("Veuillez renseigner le nombre de s\xE9ries");return}this.seriesNb=parseInt(this.seriesNb),this.preWorkoutTimer=3,this.playCountdown(),this.intervals.push(setInterval(()=>{if(this.preWorkoutTimer-=1,this.preWorkoutTimer<0){this.started=!0,this.$emit("hideNavbar"),this.currentSeries=1,this.preWorkoutTimer=null,clearInterval(this.intervals.pop()),this.startSeries(!0);return}},1e3)),this.totalRemainingTime=this.totalDuration-1,this.finishTime.value=this.getEndTime(this.totalRemainingTime)},startSeries(e=!1){this.step=1,this.startTimer(e?this.currentExercise.duration-1||0:this.currentExercise.duration||0)},startTimer(e){this.timer=e,this.currentExercise.restAbs&&this.stopInProgress(),this.timer<=3?this.playSoundLast3Sec():this.currentExercise.restAbs||this.playInProgress(),this.intervals.push(setInterval(()=>{if(this.timer--,this.totalRemainingTime--,this.timer===3&&this.playSoundLast3Sec(),this.timer<=0){clearInterval(this.intervals.pop()),this.stopLast3Sec(),this.nextStep();return}},1e3))},startRestTime(e){this.stopInProgress(),this.rest=!0,this.timer=e,this.timer<=3&&this.playSoundLast3Sec(),this.intervals.push(setInterval(()=>{if(this.timer--,this.totalRemainingTime--,this.timer===3&&this.playSoundLast3Sec(),this.timer<=0){clearInterval(this.intervals.pop()),this.stopLast3Sec(),this.nextStep();return}},1e3))},nextStep(){this.step>=this.nbExercises?this.currentSeries>=this.seriesNb?(this.finished=!0,this.playEnd(),setTimeout(()=>{this.timeouts.pop(),this.stopAbs()},5e3)):(this.playDing(),this.rest?(this.rest=!1,this.currentSeries+=1,this.startSeries()):this.startRestTime(this.selectedWorkout.restTime)):(this.playDing(),this.step+=1,this.startTimer(this.currentExercise.duration||0))}}},A=e=>(U("data-v-5e8e8e2e"),e=e(),z(),e),$={key:0,class:"fixed-center z-max fit flex flex-center text-h1 pre-workout-timer"},ee=A(()=>d("div",{class:"text-h6 text-center q-mb-lg"},"Liste des s\xE9ries",-1)),te={key:0,class:"text-center"},se=A(()=>d("p",null,"Aucune s\xE9rie d'abs disponible",-1)),ie={key:0},re={key:1,class:"q-mb-sm"},le={key:2,class:"q-mb-lg"},ne={key:1,class:"page-content column items-center"},ae={class:"flex q-mb-lg"},oe={class:"text-center q-mb-sm"},ue={key:0,class:"q-mb-lg"},he={class:"text-h5 text-center q-mb-lg"},ce={class:"text-h4 text-center q-mb-lg"},de={key:1,class:"text-h5 text-center"},me={key:2,class:"next-exercise-space"},pe={class:"text-h4 text-center q-mt-sm q-mb-lg"},fe={class:"text-h1"},ve={key:3,class:"fixed-center z-max fit flex flex-center text-h3 finished-display"};function be(e,i,s,h,t,r){const v=S("GymyHeader"),g=S("RouterLink");return n(),b(G,{class:"page flex flex-center"},{default:c(()=>[t.started?(n(),o("div",ne,[u(v,{text:"Abs - "+r.selectedWorkout.label},null,8,["text"]),d("div",ae,[t.paused?(n(),b(x,{key:1,color:"primary",label:"Reprendre",icon:"play_arrow",onClick:r.resumeAbs},null,8,["onClick"])):(n(),b(x,{key:0,color:"secondary",label:"Pause",icon:"pause",onClick:r.pauseAbs},null,8,["onClick"])),u(x,{color:"negative",label:"Arr\xEAter",class:"q-ml-md",icon:"stop",onClick:r.stopAbs},null,8,["onClick"])]),d("div",oe,"Temps restant : "+a(h.formatting().durationFromSeconds(t.totalRemainingTime)),1),t.finishTime.value?(n(),o("div",ue,"Heure de fin : "+a(h.formatting().timeToDisplay(t.finishTime.value)),1)):m("",!0),d("div",he,"S\xE9rie "+a(t.currentSeries)+"/"+a(t.seriesNb),1),d("div",ce,a(t.rest?"Inter-s\xE9ries":"\xC9tape "+t.step+"/"+r.nbExercises),1),r.futurExercise&&t.timer<=t.displayNextExercise?(n(),o("div",de,"Prochain : "+a(r.futurExercise.restAbs?"Repos \u{1F634}":r.futurExercise.label),1)):(n(),o("div",me)),d("div",pe,a(t.rest||r.currentExercise.restAbs?"Repos \u{1F634}":r.currentExercise.label),1),d("div",fe,a(t.timer),1),t.finished?(n(),o("div",ve,[u(W,null,{default:c(()=>[u(y,{class:"q-pa-lg"},{default:c(()=>[p("Termin\xE9 ! \u{1F389}")]),_:1})]),_:1})])):m("",!0)])):(n(),o("div",{key:0,class:T(["page-content column items-center",{"overflow-hidden":t.preWorkoutTimer}])},[t.preWorkoutTimer!==null?(n(),o("div",$,a(t.preWorkoutTimer>0?t.preWorkoutTimer:"Go !"),1)):m("",!0),u(v,{text:"Commencer des s\xE9ries d'Abs \u{1F4AA}"}),ee,u(j,{class:"q-mb-lg w-100"},{default:c(()=>[t.workouts.length<=0?(n(),o("div",te,[se,d("p",null,[p("Rendez-vous dans la page des "),u(g,{to:{name:"workouts"}},{default:c(()=>[p("entra\xEEnements")]),_:1}),p(" pour ajouter un entra\xEEnement d'abs")])])):m("",!0),(n(!0),o(F,null,Q(t.workouts,l=>(n(),b(W,{key:l.id,class:T(["q-mb-md",{"bg-primary":l.selected,"text-white":l.selected}]),onClick:_=>r.selectWorkout(l)},{default:c(()=>[u(y,null,{default:c(()=>[u(k,{class:"text-center text-weight-bold"},{default:c(()=>[p(a(l.label),1)]),_:2},1024),u(k,{class:"text-center text-weight-bold"},{default:c(()=>[p(a(h.formatting().durationFromSeconds(l.durationWithoutFinishers)),1),l.duration!==l.durationWithoutFinishers?(n(),o("span",ie," (derni\xE8re : "+a(h.formatting().durationFromSeconds(l.duration))+")",1)):m("",!0),p(" - "+a(l.restTime)+"s ",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1}),u(B,{name:"series_number",rounded:"",outlined:"",label:"Nombre de s\xE9ries \xE0 r\xE9aliser",class:"q-mb-lg",type:"number",inputmode:"numeric",min:"1",rules:[l=>l>0||"Veuillez renseigner un nombre de s\xE9rie sup\xE9rieur \xE0 0"],modelValue:t.seriesNb,"onUpdate:modelValue":[i[0]||(i[0]=l=>t.seriesNb=l),r.onAbsWorkoutSelectectUpdate],"hide-bottom-space":"",suffix:"s\xE9rie(s)"},null,8,["rules","modelValue","onUpdate:modelValue"]),r.isValid?(n(),o("div",re,"Dur\xE9e totale : "+a(h.formatting().durationFromSeconds(r.totalDuration)),1)):m("",!0),r.isValid?(n(),o("div",le,"Heure de fin : "+a(h.formatting().timeToDisplay(t.finishTime.value)),1)):m("",!0),u(x,{label:"Commencer",color:"primary",onClick:r.start,disable:!r.isValid},null,8,["onClick","disable"])],2))]),_:1})}var We=R(X,[["render",be],["__scopeId","data-v-5e8e8e2e"]]);export{We as default};
